# ===============================================
# FICHIER .ENV PRODUCTION - Inventaire SI
# ===============================================
# IMPORTANT: Ce fichier contient des exemples
# NE PAS UTILISER CES VALEURS EN PRODUCTION!
# Générer des valeurs fortes et uniques
# ===============================================

# ===== BASE DE DONNÉES =====
DATABASE_URL="postgresql://inventaire_user:GÉNÉRER_MDP_FORT_ICI@postgres:5432/inventaire"
POSTGRES_PASSWORD="GÉNÉRER_MDP_FORT_ICI"

# Comment générer un mot de passe fort:
# openssl rand -base64 32

# ===== JWT SECRETS =====
# CRITIQUE: Générer des secrets uniques et forts (64+ caractères)
# Commande: openssl rand -base64 64
JWT_ACCESS_SECRET="GÉNÉRER_SECRET_UNIQUE_64_CHARS_MINIMUM_AVEC_OPENSSL"
JWT_REFRESH_SECRET="GÉNÉRER_AUTRE_SECRET_UNIQUE_64_CHARS_MINIMUM_AVEC_OPENSSL"

# Durées d'expiration
JWT_ACCESS_EXPIRY="15m"
JWT_REFRESH_EXPIRY="7d"

# ===== REDIS =====
REDIS_HOST="redis"
REDIS_PORT="6379"
REDIS_PASSWORD="GÉNÉRER_MDP_REDIS_FORT_ICI"

# Comment générer:
# openssl rand -base64 32

# ===== CORS =====
# Domaine autorisé à accéder à l'API
# Avec reverse proxy Nginx HTTPS: https://192.168.1.225
CORS_ORIGIN="https://www.TillyInventaire.ti,https://192.168.1.225"

# ===== SENTRY (Monitoring Erreurs) =====
# Créer compte sur https://sentry.io
# Créer un projet pour backend et un pour frontend

# Backend Sentry
SENTRY_DSN="https://YOUR_BACKEND_DSN_HERE@o00000000.ingest.sentry.io/0000000"
SENTRY_ENVIRONMENT="production"
SENTRY_TRACES_SAMPLE_RATE="0.1"

# Frontend Sentry (injecte au build Docker)
VITE_SENTRY_DSN="https://YOUR_FRONTEND_DSN_HERE@o00000000.ingest.sentry.io/0000000"
VITE_SENTRY_ENVIRONMENT="production"
VITE_SENTRY_TRACES_SAMPLE_RATE="0.1"
VITE_SENTRY_REPLAYS_SESSION_SAMPLE_RATE="0.1"
VITE_SENTRY_REPLAYS_ON_ERROR_SAMPLE_RATE="1.0"
VITE_APP_VERSION="0.9.7"

# ===== NODE ENVIRONMENT =====
NODE_ENV="production"
PORT="3000"

# ===== UPLOADS =====
SIGNATURES_DIR="/app/uploads/signatures"
MAX_FILE_SIZE="5242880"

# ===== RATE LIMITING =====
# Fenêtre de temps en millisecondes (15 minutes = 900000ms)
RATE_LIMIT_WINDOW_MS="900000"
RATE_LIMIT_MAX_REQUESTS="100"

# Auth endpoints (plus restrictif)
RATE_LIMIT_AUTH_WINDOW_MS="900000"
RATE_LIMIT_AUTH_MAX_REQUESTS="5"

# ===== FRONTEND =====
# URL de l'API — avec reverse proxy Nginx, utiliser une URL relative (same origin)
VITE_API_URL="/api"

# ===== GRAFANA =====
GRAFANA_PASSWORD="CHANGER_MOI_PASSWORD_ADMIN_GRAFANA"

# ===== DOCKER COMPOSE =====
# Utilisé dans docker-compose.prod.yml
COMPOSE_PROJECT_NAME="inventaire-si"

# ===============================================
# INSTRUCTIONS DE CONFIGURATION
# ===============================================

# 1. Copier ce fichier:
#    cp .env.production.example apps/api/.env
#    cp .env.production.example apps/web/.env

# 2. Générer les secrets JWT:
#    openssl rand -base64 64
#    (Exécuter 2 fois pour JWT_ACCESS_SECRET et JWT_REFRESH_SECRET)

# 3. Générer les mots de passe:
#    openssl rand -base64 32
#    (Pour POSTGRES_PASSWORD et REDIS_PASSWORD)

# 4. Configurer Sentry:
#    - Créer compte sur https://sentry.io
#    - Créer projet backend
#    - Créer projet frontend
#    - Copier les DSN dans les variables appropriées

# 5. Remplacer les domaines:
#    - Remplacer "votre-domaine.com" par votre vrai domaine
#    - Remplacer "api.votre-domaine.com" par votre sous-domaine API

# 6. Vérifier toutes les valeurs:
#    grep "GÉNÉRER\|CHANGER\|VOTRE" apps/api/.env
#    (Ne devrait rien retourner si tout est configuré)

# ===============================================
# EXEMPLES DE VALEURS GÉNÉRÉES (À NE PAS UTILISER!)
# ===============================================

# Exemple JWT_ACCESS_SECRET (GÉNÉRER LE VÔTRE!):
# JWT_ACCESS_SECRET="kJh3mN9pQ2wE5rT8yU1iO4pA7sD0fG6hJ2kL5zX8cV3bN6mQ9wE2rT5yU8iO1pA4sD7fG0hJ3kL6zX9cV2bN5mQ8wE1rT4yU7iO0pA3sD6fG9hJ2kL5zX8cV1bN4mQ7wE0rT3yU6iO9pA2sD5fG8hJ1kL4zX7cV0bN3mQ6wE9rT2yU5iO8pA1sD4fG7hJ0kL3zX6cV9bN2mQ5wE8rT1yU4iO7pA0sD3fG6hJ9kL2zX5cV8bN1mQ4wE7rT0yU3iO6pA9sD2fG5hJ8kL1zX4cV7bN0m"

# Exemple JWT_REFRESH_SECRET (GÉNÉRER LE VÔTRE!):
# JWT_REFRESH_SECRET="pL4zY7xW0cV3bN6mK9qE2rT5yU8iO1pH4sD7fG0jK3lL6zX9cV2bN5mQ8wE1rT4yU7iO0pA3sD6fG9hJ2kL5zX8cV1bN4mQ7wE0rT3yU6iO9pA2sD5fG8hJ1kL4zX7cV0bN3mQ6wE9rT2yU5iO8pA1sD4fG7hJ0kL3zX6cV9bN2mQ5wE8rT1yU4iO7pA0sD3fG6hJ9kL2zX5cV8bN1mQ4wE7rT0yU3iO6pA9sD2fG5hJ8kL1zX4cV7bN0mQ3wE6rT9yU2iO5pA8sD1fG4hJ7kL0zX3cV6bN9m"

# Exemple POSTGRES_PASSWORD (GÉNÉRER LE VÔTRE!):
# POSTGRES_PASSWORD="7K9mP2wE5rT8yU1iO4pL3sD6fG9hJ0kL5zX8cV2bN"

# Exemple REDIS_PASSWORD (GÉNÉRER LE VÔTRE!):
# REDIS_PASSWORD="3mN6pQ9wE2rT5yU8iO1pA4sD7fG0hJ3kL6zX9cV2b"

# ===============================================
# SÉCURITÉ
# ===============================================

# ⚠️ IMPORTANT:
# - NE JAMAIS commiter ce fichier avec des vraies valeurs
# - Ajouter .env dans .gitignore
# - Utiliser un gestionnaire de secrets (Vault, AWS Secrets Manager, etc.)
# - Changer TOUS les secrets si exposition accidentelle
# - Utiliser des secrets différents pour dev/staging/production

# Vérifier que .env est dans .gitignore:
# grep "\.env" .gitignore

# Si .env a été commité accidentellement:
# 1. Changer TOUS les secrets immédiatement
# 2. Supprimer du git history:
#    git filter-branch --force --index-filter \
#    "git rm --cached --ignore-unmatch apps/api/.env" \
#    --prune-empty --tag-name-filter cat -- --all

# ===============================================
# FIN DU FICHIER
# ===============================================
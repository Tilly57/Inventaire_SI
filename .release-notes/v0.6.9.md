# Release Notes - Version 0.6.9

**Date**: 2025-12-30

## üöÄ Nouvelle Fonctionnalit√©

### Ajout de quantit√© lors de la modification d'un mod√®le d'√©quipement

Il est d√©sormais possible d'ajouter des √©quipements suppl√©mentaires lors de la modification d'un mod√®le existant, sans affecter les √©quipements d√©j√† cr√©√©s.

**Fonctionnalit√©s :**
- ‚úÖ Champ "Ajouter une quantit√©" visible en mode √©dition d'un mod√®le
- ‚úÖ Cr√©ation automatique de nouveaux √©quipements avec tags auto-g√©n√©r√©s
- ‚úÖ Num√©rotation continue √† partir des √©quipements existants
- ‚úÖ Les √©quipements existants ne sont jamais modifi√©s
- ‚úÖ Mise √† jour automatique de la quantit√© affich√©e
- ‚úÖ Rafra√Æchissement automatique de la liste des √©quipements

**Exemple d'utilisation :**
1. Modifier un mod√®le existant (ex: "Ordinateur portable HP ProBook 450 G9")
2. Renseigner "Ajouter une quantit√©" : 5
3. Sauvegarder
4. R√©sultat : 5 nouveaux √©quipements cr√©√©s (LAP-002, LAP-003, LAP-004, LAP-005, LAP-006)

## üîß Corrections Techniques

### Backend (API)
- **Security**: Correction de la validation des secrets Docker
  - Ne valide plus le `DATABASE_URL` comme secret sensible
  - Validation limit√©e aux secrets JWT uniquement
  - √âvite les faux positifs (ex: "postgres" dans l'URL de BDD)

- **Validation**: Ajout du champ `quantity` au sch√©ma de mise √† jour des mod√®les
  - Fichier: `apps/api/src/validators/assetModels.validator.js`
  - Permet l'envoi de la quantit√© lors de l'update

- **Service**: Support de la cr√©ation d'√©quipements suppl√©mentaires
  - Fichier: `apps/api/src/services/assetModels.service.js`
  - Utilise `createAssetItemsBulk` pour la cr√©ation en masse
  - G√®re correctement la num√©rotation continue

### Frontend (Web)
- **Cache Management**: Invalidation du cache `assetItems` apr√®s update
  - Fichier: `apps/web/src/lib/hooks/useAssetModels.ts`
  - Garantit l'affichage imm√©diat des nouveaux √©quipements

- **Formulaire**: Affichage du champ quantit√© en mode √©dition
  - Fichier: `apps/web/src/components/assets/AssetModelFormDialog.tsx`
  - Labels adaptatifs selon le mode (cr√©ation/√©dition)
  - Texte d'aide contextuel

- **TypeScript**: Correction des imports
  - Fichier: `apps/web/src/components/common/ResponsiveTable.tsx`
  - Utilisation de `import type` pour les types React
  - R√©solution des warnings de compilation

## üìù Fichiers Modifi√©s

**Backend (3 fichiers) :**
- `apps/api/src/index.js`
- `apps/api/src/validators/assetModels.validator.js`
- `apps/api/src/services/assetModels.service.js`

**Frontend (4 fichiers) :**
- `apps/web/src/lib/hooks/useAssetModels.ts`
- `apps/web/src/lib/schemas/assetModels.schema.ts`
- `apps/web/src/components/assets/AssetModelFormDialog.tsx`
- `apps/web/src/components/common/ResponsiveTable.tsx`

## ‚úÖ Tests

- [x] Ajout de quantit√© lors de la modification d'un mod√®le
- [x] Cr√©ation automatique des √©quipements avec tags auto-g√©n√©r√©s
- [x] Num√©rotation continue correcte
- [x] Mise √† jour de l'affichage de la quantit√©
- [x] Rafra√Æchissement de la liste des √©quipements
- [x] √âquipements existants non modifi√©s
- [x] D√©marrage de l'API sans erreur de validation des secrets

## üîÑ Migration

Aucune migration de base de donn√©es requise pour cette version.

## üì¶ D√©ploiement

```bash
# Reconstruire les conteneurs
docker-compose down
docker-compose up -d --build

# V√©rifier les logs
docker-compose logs api --tail=20
docker-compose logs web --tail=20
```

---

**Commit principal** : `2877ffb` - feat: Ajout de quantit√© lors de la modification d'un mod√®le d'√©quipement

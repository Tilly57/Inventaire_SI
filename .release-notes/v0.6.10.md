# Release Notes - Version 0.6.10

**Date**: 2025-12-30

## üêõ Corrections Critiques

### Correction du type AssetItem et r√©solution des probl√®mes Dashboard

Cette release corrige plusieurs bugs critiques introduits dans les versions pr√©c√©dentes qui emp√™chaient le dashboard de fonctionner correctement.

**Probl√®mes r√©solus :**
- ‚úÖ Dashboard affiche maintenant les statistiques correctement
- ‚úÖ Alertes de stock fonctionnelles
- ‚úÖ Pr√™ts r√©cents cliquables (plus d'erreur "pr√™t non trouv√©")
- ‚úÖ Plus d'erreurs 429 Too Many Requests (boucle infinie de requ√™tes)

## üîß Corrections Techniques

### 1. Correction du type AssetItem (TypeScript)

**Probl√®me :** Incoh√©rence entre le sch√©ma Prisma et les types TypeScript.
- Sch√©ma Prisma utilise : `assetModelId`
- Type TypeScript utilisait : `modelId`

**Solution :** Alignement complet sur `assetModelId`

**Fichiers modifi√©s :**
- `apps/web/src/lib/types/models.types.ts`
  - Interface `AssetItem` : `modelId` ‚Üí `assetModelId`
  - Interface `UpdateAssetModelDto` : ajout du champ `quantity`

- `apps/web/src/lib/api/dashboard.api.ts` (ligne 185)
  - `item.modelId` ‚Üí `item.assetModelId`

- `apps/web/src/components/assets/AssetItemFormDialog.tsx` (ligne 96)
  - `item.modelId` ‚Üí `item.assetModelId`

- `apps/web/src/pages/AssetItemsListPage.tsx` (ligne 46)
  - `item.modelId` ‚Üí `item.assetModelId`

### 2. Correction de la boucle infinie de requ√™tes

**Probl√®me :** L'invalidation du cache `assetItems` dans `useUpdateAssetModel` causait une cascade infinie d'invalidations et de refetch, g√©n√©rant des erreurs 429 Too Many Requests.

**Solution :** Retrait de l'invalidation probl√©matique du cache `assetItems` dans le hook `useUpdateAssetModel`.

**Fichier modifi√© :**
- `apps/web/src/lib/hooks/useAssetModels.ts`
  - Suppression de `await queryClient.invalidateQueries({ queryKey: ['assetItems'] })`

**Note :** Pour rafra√Æchir la liste des √©quipements apr√®s ajout de quantit√©, l'utilisateur doit manuellement recharger la page ou naviguer vers la page √âquipements.

### 3. Am√©lioration du Dashboard

**Corrections dans `getLowStockItemsApi` :**
- Utilisation correcte de `assetModelId` pour grouper les √©quipements par mod√®le
- Calcul correct du stock disponible pour chaque mod√®le
- Alertes de stock d√©sormais fonctionnelles

## üìù Fichiers Modifi√©s

**Frontend (5 fichiers) :**
- `apps/web/src/lib/types/models.types.ts` - Correction types
- `apps/web/src/lib/api/dashboard.api.ts` - Fix dashboard
- `apps/web/src/lib/hooks/useAssetModels.ts` - Fix cache
- `apps/web/src/components/assets/AssetItemFormDialog.tsx` - Fix formulaire
- `apps/web/src/pages/AssetItemsListPage.tsx` - Fix filtrage

## ‚ö†Ô∏è Notes Importantes

### Comportement apr√®s modification de mod√®le avec quantit√©

Apr√®s avoir ajout√© une quantit√© √† un mod√®le d'√©quipement :
1. La quantit√© du mod√®le est mise √† jour imm√©diatement ‚úÖ
2. Pour voir les nouveaux √©quipements cr√©√©s, il faut :
   - Recharger la page (F5), OU
   - Naviguer vers la page "√âquipements"

**Raison :** L'invalidation automatique du cache `assetItems` a √©t√© retir√©e pour √©viter les boucles infinies de requ√™tes.

## ‚úÖ Tests

- [x] Dashboard affiche les statistiques correctement
- [x] Alertes de stock s'affichent
- [x] Clic sur employ√© dans pr√™ts r√©cents fonctionne
- [x] Plus d'erreurs 429 Too Many Requests
- [x] Modification de mod√®le avec quantit√© fonctionne
- [x] Filtrage par mod√®le dans page √âquipements fonctionne
- [x] Formulaire √©dition √©quipement fonctionne

## üîÑ Migration

Aucune migration de base de donn√©es requise pour cette version.

## üì¶ D√©ploiement

```bash
# Reconstruire les conteneurs
docker-compose down
docker-compose up -d --build

# V√©rifier les logs
docker-compose logs api --tail=20
docker-compose logs web --tail=20
```

---

**Commits principaux :**
- `eed3107` - fix: Correction du type AssetItem et des requ√™tes dashboard
- `2877ffb` - feat: Ajout de quantit√© lors de la modification d'un mod√®le d'√©quipement (v0.6.9)
